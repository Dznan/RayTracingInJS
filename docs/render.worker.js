!function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);var r,i=function(){function t(t,n,e){this.imageData="number"==typeof t?new ImageData(t,n):new ImageData(t,n,e),this.data=this.imageData.data}return t.prototype.getPixel=function(t,n){var e=n*this.imageData.width+t<<2;return[this.data[e],this.data[e+1],this.data[e+2],this.data[e+3]]},t.prototype.setPixel=function(t,n,e){var r=n*this.imageData.width+t<<2;this.data[r]=e[0],this.data[r+1]=e[1],this.data[r+2]=e[2],this.data[r+3]=e.length>3?this.data[3]:255},Object.defineProperty(t.prototype,"width",{get:function(){return this.imageData.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.imageData.height},enumerable:!1,configurable:!0}),t}(),o=function(){function t(){}return t.degreeToRadians=function(t){return t*Math.PI/180},t.random=function(t,n){return t?(n-t)*Math.random()+t:Math.random()},t.clamp=function(t,n,e){return Math.min(Math.max(t,n),e)},t.sampleColor=function(n){for(var e=n.length,r=new a(0,0,0),i=0,o=n;i<o.length;i++){var u=o[i];r=r.add(u)}return(r=(r=r.scale(1/e)).apply(Math.sqrt).apply((function(n){return t.clamp(n,0,.99999)}))).scale(256)},t.randomInUnitSphere=function(){for(;;){var t=a.random(-1,1);if(!(t.magnitude()>=1))return t}},t.randomUnitVector=function(){var n=t.random(0,2*Math.PI),e=t.random(-1,1),r=Math.sqrt(1-e*e);return new a(r*Math.cos(n),r*Math.sin(n),e)},t.randomInHemisphere=function(n){var e=t.randomInUnitSphere();return a.dot(e,n)>0?e:e.neg()},t.randomInUnitDisk=function(){for(;;){var n=new a(t.random(-1,1),t.random(-1,1),0);if(!(n.magnitude()>=1))return n}},t.reflect=function(t,n){return t.sub(n.scale(2*a.dot(t,n)))},t.refract=function(t,n,e){var r=a.dot(t.neg(),n),i=t.add(n.scale(r)).scale(e),o=n.scale(-Math.sqrt(Math.abs(1-i.magnitude()*i.magnitude())));return i.add(o)},t.schlick=function(t,n){var e=(1-n)/(1+n);return(e*=e)+(1-e)*Math.pow(1-t,5)},t}(),a=function(){function t(n,e,r){var i=[0,0,0];"number"==typeof n?i=[n,e,r]:Array.isArray(n)?i=t.fromValues.apply(t,n):n instanceof t&&(i=t.fromValues(n[0],n[1],n[2])),this[0]=i[0],this[1]=i[1],this[2]=i[2]}return t.zeros=function(){return new t(0,0,0)},t.random=function(n,e){return n?new t(o.random(n,e),o.random(n,e),o.random(n,e)):new t(o.random(),o.random(),o.random())},t.fromValues=function(t,n,e){return Array.isArray(t)?[t[0],t[1],t[2]]:[t,n,e]},t.add=function(n,e,r){return n||(n=t.zeros()),n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n},t.sub=function(n,e,r){return n||(n=t.zeros()),n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n},t.mul=function(n,e,r){return n||(n=t.zeros()),n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n},t.scale=function(n,e,r){return n||(n=t.zeros()),n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n},t.divide=function(n,e,r){return n||(n=t.zeros()),n[0]=e[0]/r,n[1]=e[1]/r,n[2]=e[2]/r,n},t.neg=function(n,e){return n||(n=t.zeros()),n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n},t.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},t.cross=function(n,e,r){return n||(n=t.zeros()),n[0]=e[1]*r[2]-e[2]*r[1],n[1]=e[2]*r[0]-e[0]*r[2],n[2]=e[0]*r[1]-e[1]*r[0],n},t.magnitude=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},t.uniform=function(n){return t.divide(void 0,n,t.magnitude(n))},t.apply=function(n,e,r){return n||(n=t.zeros()),n[0]=e(r[0]),n[1]=e(r[1]),n[2]=e(r[2]),n},t.clone=function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},t.prototype.clone=function(){return new t(this[0],this[1],this[2])},t.prototype.add=function(n){return t.add(void 0,this,n)},t.prototype.sub=function(n){return t.sub(void 0,this,n)},t.prototype.mul=function(n){return t.mul(void 0,this,n)},t.prototype.scale=function(n){return t.scale(void 0,this,n)},t.prototype.divide=function(n){return t.divide(void 0,this,n)},t.prototype.neg=function(){return t.neg(void 0,this)},t.prototype.dot=function(n){return t.dot(this,n)},t.prototype.cross=function(n){return t.cross(void 0,this,n)},t.prototype.magnitude=function(){return t.magnitude(this)},t.prototype.uniform=function(){return t.uniform(this)},t.prototype.apply=function(n){return t.apply(void 0,n,this)},Object.defineProperty(t.prototype,"length",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this[2]},set:function(t){this[2]=t},enumerable:!1,configurable:!0}),t}(),u=function(){function t(t,n){this.origin=t?new a(t):a.zeros(),this.direction=n?new a(n):a.zeros()}return t.prototype.at=function(t){return this.direction.scale(t).add(this.origin)},t.clone=function(t,n){t.origin=new a(n.origin),t.direction=new a(n.direction)},t}(),s=function(){function t(){}return t.prototype.setFaceNormal=function(t,n){this.isFrontFace=a.dot(t.direction,n)<0,this.normal=this.isFrontFace?n:n.neg()},t.clone=function(t,n){t.p=new a(n.p),t.normal=new a(n.normal),t.t=n.t,t.isFrontFace=n.isFrontFace,t.material=n.material},t}(),c=function(){function t(){this.hittableObjects=[]}return t.prototype.hit=function(t,n,e,r){for(var i=new s,o=!1,a=e,u=0,c=this.hittableObjects;u<c.length;u++)c[u].hit(t,n,a,i)&&(o=!0,a=i.t,s.clone(r,i));return o},t.prototype.clear=function(){this.hittableObjects=[]},t.prototype.add=function(t){this.hittableObjects.push(t)},t}(),d=function(){function t(t,n,e){this.center=t||new a(t),this.radius=n||1,this.material=e||void 0}return t.prototype.hit=function(t,n,e,r){var i=t.origin.sub(this.center),o=a.dot(t.direction,t.direction),u=a.dot(i,t.direction),s=u*u-o*(a.dot(i,i)-this.radius*this.radius);if(s>0)for(var c=Math.sqrt(s),d=0,f=[(-u-c)/o,(-u+c)/o];d<f.length;d++){var h=f[d];if(h<e&&h>n)return r.t=h,r.p=new a(t.at(r.t)),r.setFaceNormal(t,new a(r.p.sub(this.center).divide(this.radius))),r.material=this.material,!0}return!1},t}(),f=function(){function t(t,n,e,r,i,u,s){var c=o.degreeToRadians(n),d=Math.tan(c/2);this.verticalFieldOfView=n,this.aspectRatio=t,this.viewportHeight=2*d,this.viewportWidth=t*this.viewportHeight,this.aperture=e,this.focusDist=r,this.lensRadius=e/2,this.w=a.uniform(i.sub(u)),this.u=a.uniform(s.cross(this.w)),this.v=this.w.cross(this.u),this.origin=i,this.horizontal=this.u.scale(this.viewportWidth*r),this.vertical=this.v.scale(this.viewportHeight*r),this.lowerLeftCorner=this.origin.sub(this.horizontal.scale(.5)).sub(this.vertical.scale(.5)).sub(this.w.scale(r))}return t.prototype.getRay=function(t,n){var e=o.randomInUnitDisk().scale(this.lensRadius),r=this.u.scale(e.x).add(this.v.scale(e.y));return new u(this.origin.add(r),this.lowerLeftCorner.add(this.horizontal.scale(t)).add(this.vertical.scale(n)).sub(this.origin).sub(r))},t}(),h=function(){function t(t){this.albedo=t}return t.prototype.scatter=function(t,n,e,r){var i=n.normal.add(o.randomUnitVector());return u.clone(r,new u(n.p,i)),a.clone(e,this.albedo),!0},t}(),l=function(){function t(t,n){this.albedo=t,this.fuzziness=n}return t.prototype.scatter=function(t,n,e,r){var i=o.reflect(a.uniform(t.direction),n.normal);return u.clone(r,new u(n.p,i.add(o.randomInUnitSphere().scale(this.fuzziness)))),a.clone(e,this.albedo),a.dot(r.direction,n.normal)>0},t}(),p=function(){function t(t){this.refIdx=t}return t.prototype.scatter=function(t,n,e,r){a.clone(e,new a(1,1,1));var i=n.isFrontFace?1/this.refIdx:this.refIdx,s=a.uniform(t.direction),c=Math.min(a.dot(s.neg(),n.normal),1);if(i*Math.sqrt(1-c*c)>1){var d=o.reflect(s,n.normal);return u.clone(r,new u(n.p,d)),!0}var f=o.schlick(c,i);if(o.random()<f)return d=o.reflect(s,n.normal),u.clone(r,new u(n.p,d)),!0;var h=o.refract(s,n.normal,i);return u.clone(r,new u(n.p,h)),!0},t}();function m(t,n,e){if(e<=0)return a.zeros();var r=new s;if(n.hit(t,1e-5,1/0,r)){var i=new u,o=a.zeros();return r.material.scatter(t,r,o,i)?o.mul(m(i,n,e-1)):new a(0,0,0)}var c=.5*(a.uniform(t.direction).y+1);return new a(1,1,1).scale(1-c).add(new a(.5,.7,1).scale(c))}function v(t,n,e,r){void 0===e&&(e=1),void 0===r&&(r=50);for(var u=t.width,s=t.height,v=u/s,w=new i(u,s),g=new a(13,2,3),y=new a(0,0,0),b=new a(0,1,0),M=new f(v,20,.1,10,g,y,b),z=function(){var t=new c,n=new h(new a(.5,.5,.5));t.add(new d(new a(0,-1e3,0),1e3,n));for(var e=-11;e<11;++e)for(var r=-11;r<11;++r){var i=o.random(),u=new a(e+.9*o.random(),.2,r+.9*o.random());if(u.sub(new a(4,.2,0)).magnitude()>.9){var s=void 0;if(i<.8){var f=new a(o.random(0,1),o.random(0,1),o.random(0,1)).mul(new a(o.random(0,1),o.random(0,1),o.random(0,1)));s=new h(f),t.add(new d(u,.2,s))}else if(i<.95){f=new a(o.random(.5,1),o.random(.5,1),o.random(.5,1));var m=o.random(0,.5);s=new l(f,m),t.add(new d(u,.2,s))}else s=new p(1.5),t.add(new d(u,.2,s))}}var v=new p(1.5);t.add(new d(new a(0,1,0),1,v));var w=new h(new a(.4,.2,.1));t.add(new d(new a(-4,1,0),1,w));var g=new l(new a(.7,.6,.5),0);return t.add(new d(new a(4,1,0),1,g)),t}(),O=0;O<u;++O){for(var P=0;P<s;++P){for(var j=[],x=0;x<e;++x){var I=(O+o.random())/(u-1),D=(P+o.random())/(s-1),F=M.getRay(I,D);j.push(m(F,z,r))}w.setPixel(O,s-P-1,o.sampleColor(j))}postMessage({progress:O/u})}n.putImageData(w.imageData,0,0)}addEventListener("message",(function(t){var n,e,i;"init"===t.data.msg?r=t.data.canvas:"render"===t.data.msg&&(n=r,e=t.data.payload.samplesPerPixel,i=t.data.payload.depth,n.getContext&&v(n,n.getContext("2d"),e=e||4,i=i||50))}))}]);